/*
 * jQuery
 * @copyright : GigolNet
 * @author : Ilia GUIGOLACHVILI
 * @web : http://gigol.net
 * @plugin : cMenu
 * @version : 1.1.0
 * Last modified : 26/01/2015
 */
(function(b){var c={setSettings:function(d){this.settings=d},init:function(){if(this.settings.preventDoubleContext){b(document).on("contextmenu",".cmenu-dropdown",function(d){d.preventDefault()})}b(document).on("mouseenter",".cmenu-dropdown-submenu",function(){var f=b(this).find(".cmenu-dropdown-sub:first"),e=f.width(),d=f.offset().left,g=(e+d)>window.innerWidth;if(g){f.addClass("cmenu-drop-left")}})},builderMenu:function(f,j,p){var d=(p)?" cmenu-dropdown-sub":"",m=this.settings.compress?" cmenu-compressed":"",g=b('<ul class="cmenu cmenu-dropdown'+d+m+'" id="cmenu-'+f+'" data=""></ul>'),q;var k=0,o="",l="";for(k;k<j.length;k++){if(typeof j[k].closing!=="undefined"){g.append('<li id="cmenu-close-'+f+'" class="cmenu-close" title="Close">CLOSE</li>')}if(typeof j[k].divider!=="undefined"){g.append('<li class="cmenu-divider"></li>')}else{if(typeof j[k].header!=="undefined"){g.append('<li class="cmenu-header">'+j[k].header+"</li>")}else{if(typeof j[k].before!=="undefined"){}else{if(typeof j[k].href==="undefined"){j[k].href="#"}if(typeof j[k].target!=="undefined"){o=' target="'+j[k].target+'"'}if(typeof j[k].subMenu!=="undefined"){q=b('<li class="cmenu-dropdown-submenu"><a tabindex="-1" href="'+j[k].href+'">'+j[k].text+"</a></li>")}else{if(typeof j[k].html!=="undefined"){l=b(j[k].html).html();q=b("<li>"+l+"</li>")}else{if(typeof j[k].fragment!=="undefined"){q=b("<li>"+j[k].fragment+"</li>")}else{q=b('<li><a tabindex="-1" href="'+j[k].href+'"'+o+">"+j[k].text+"</a></li>")}}}var e=new Date(),h="event-"+e.getTime()*Math.floor(Math.random()*100000);q.find("a").attr("id",h);b("#"+h).addClass("cmenu-event");if(typeof j[k].click!=="undefined"){b(document).on("click","#"+h,j[k].click)}if(typeof j[k].hover!=="undefined"){b(document).on("mouseenter","#"+h,j[k].hover);b(document).on("mouseleave","#"+h,j[k].hover)}g.append(q);if(typeof j[k].subMenu!="undefined"){var n=c.builderMenu(f,j[k].subMenu,true);g.find("li:last").append(n)}}}}}return g},destroyContext:function(d){b(document).off("contextmenu",d).off("click",".cmenu-event")},closing:function(d){d.fadeOut(this.settings.fadeSpeed,function(){d.css({display:""}).find(".cmenu-drop-left").removeClass("cmenu-drop-left");if(typeof d.attr("data")!=="undefined"){d.removeClass("cmenu-attach-data-"+d.attr("data"));d.attr("data","")}})},closeAll:function(){var d=b(".cmenu");d.fadeOut(function(){d.css({display:""}).find(".cmenu-drop-left").removeClass("cmenu-drop-left");if(typeof d.attr("data")!=="undefined"){d.removeClass("cmenu-attach-data-"+d.attr("data"));d.attr("data","")}})}};var a={setSettings:function(d){this.settings=d},before:function(d,e){if(this.settings.before){this.settings.before.call(this,d,e)}}};b.fn.cMenu=function(j,p){var i=this;var l=new Date();var k=b.extend({id:l.getTime(),data:null,draggable:true,fadeSpeed:100,above:"auto",preventDoubleContext:true,compress:false,closing:"html"},p);var m=k.id,f=k.data,o=k.fadeSpeed,n=k.above,h=k.draggable;c.setSettings(k);a.setSettings(k);if(j==="open"){c.init();var g=c.builderMenu(m,f);b("body").append(g);b(i).on("contextmenu",function(q){q.preventDefault();q.stopPropagation();a.before(b(this),g);b(".cmenu-dropdown:not(.cmenu-dropdown-sub)").hide();if(typeof b(this).attr("data")!=="undefined"){g.attr("data",b(this).attr("data"));g.addClass("cmenu-attach-data-"+b(this).attr("data"))}if(typeof n=="boolean"&&n){g.addClass("cmenu-dropdown-up").css({top:q.pageY-20-b("#cmenu-"+m).height(),left:q.pageX-13}).fadeIn(o)}else{if(typeof n=="string"&&n=="auto"){g.removeClass("cmenu-dropdown-up");var d=g.height()+12;if((q.pageY+d)>b("html").height()){g.addClass("cmenu-dropdown-up").css({top:q.pageY-20-d,left:q.pageX-13}).fadeIn(o)}else{g.css({top:q.pageY+10,left:q.pageX-13}).fadeIn(o)}}}});if(h){g.draggable()}b(g).on("contextmenu",function(){c.closing(g)});b(g).on("click","#cmenu-close-"+m,function(){c.closing(g)});return m}else{if(j==="close"){var e=b(this).closest(".cmenu").attr("id");c.closing(b("#"+e))}}};b.fn.cMenu.close=function(){c.closeAll()}}(jQuery));