/*
 * jQuery
 * @copyright : GigolNet
 * @author : Ilia GUIGOLACHVILI
 * @web : http://gigol.net
 * @plugin : cMenu
 * @version : 1.0.0
 * Last modified : 25/01/2015
 */
(function(b){var c={setSettings:function(d){this.settings=d},init:function(){if(this.settings.preventDoubleContext){b(document).on("contextmenu",".cmenu-dropdown",function(d){d.preventDefault()})}b(document).on("mouseenter",".cmenu-dropdown-submenu",function(){var f=b(this).find(".cmenu-dropdown-sub:first"),e=f.width(),d=f.offset().left,g=(e+d)>window.innerWidth;if(g){f.addClass("cmenu-drop-left")}})},builderMenu:function(f,j,p){var d=(p)?" cmenu-dropdown-sub":"",m=this.settings.compress?" cmenu-compressed":"",g=b('<ul class="cmenu cmenu-dropdown'+d+m+'" id="cmenu-'+f+'" data=""></ul>'),q;var k=0,o="",l="";for(k;k<j.length;k++){if(typeof j[k].close!=="undefined"){g.append('<li id="cmenu-close-'+f+'" class="cmenu-close" title="Close">CLOSE</li>')}if(typeof j[k].divider!=="undefined"){g.append('<li class="cmenu-divider"></li>')}else{if(typeof j[k].header!=="undefined"){g.append('<li class="cmenu-header">'+j[k].header+"</li>")}else{if(typeof j[k].before!=="undefined"){}else{if(typeof j[k].href==="undefined"){j[k].href="#"}if(typeof j[k].target!=="undefined"){o=' target="'+j[k].target+'"'}if(typeof j[k].subMenu!=="undefined"){q=b('<li class="cmenu-dropdown-submenu"><a tabindex="-1" href="'+j[k].href+'">'+j[k].text+"</a></li>")}else{if(typeof j[k].html!=="undefined"){l=b(j[k].html).html();q=b("<li>"+l+"</li>")}else{if(typeof j[k].fragment!=="undefined"){q=b("<li>"+j[k].fragment+"</li>")}else{q=b('<li><a tabindex="-1" href="'+j[k].href+'"'+o+">"+j[k].text+"</a></li>")}}}var e=new Date(),h="event-"+e.getTime()*Math.floor(Math.random()*100000);q.find("a").attr("id",h);b("#"+h).addClass("cmenu-event");if(typeof j[k].click!=="undefined"){b(document).on("click","#"+h,j[k].click)}if(typeof j[k].hover!=="undefined"){b(document).on("mouseenter","#"+h,j[k].hover);b(document).on("mouseleave","#"+h,j[k].hover)}g.append(q);if(typeof j[k].subMenu!="undefined"){var n=c.builderMenu(f,j[k].subMenu,true);g.find("li:last").append(n)}}}}}return g},destroyContext:function(d){b(document).off("contextmenu",d).off("click",".cmenu-event")},close:function(){var d=b(".cmenu-dropdown");d.fadeOut(this.settings.fadeSpeed,function(){d.css({display:""}).find(".cmenu-drop-left").removeClass("cmenu-drop-left");if(typeof d.attr("data")!=="undefined"){d.removeClass("cmenu-attach-data-"+d.attr("data"));d.attr("data","")}})}};var a={setSettings:function(d){this.settings=d},before:function(d,e){if(this.settings.before){this.settings.before.call(this,d,e)}}};b.fn.cMenu=function(n){var g=this;var j=new Date();var i=b.extend({id:j.getTime(),data:null,draggable:true,fadeSpeed:100,above:"auto",preventDoubleContext:true,compress:false,close:"html",before:false},n);var k=i.id,e=i.data,m=i.fadeSpeed,l=i.above,f=i.draggable;a.setSettings(i);c.setSettings(i);c.init();var h=c.builderMenu(k,e);b("body").append(h);b(g).on("contextmenu",function(o){o.preventDefault();o.stopPropagation();var p=b("#cmenu-"+k);a.before(b(this),p);b(".cmenu-dropdown:not(.cmenu-dropdown-sub)").hide();if(typeof b(this).attr("data")!=="undefined"){p.attr("data",b(this).attr("data"));p.addClass("cmenu-attach-data-"+b(this).attr("data"))}if(typeof l=="boolean"&&l){p.addClass("cmenu-dropdown-up").css({top:o.pageY-20-b("#cmenu-"+k).height(),left:o.pageX-13}).fadeIn(m)}else{if(typeof l=="string"&&l=="auto"){p.removeClass("cmenu-dropdown-up");var d=p.height()+12;if((o.pageY+d)>b("html").height()){p.addClass("cmenu-dropdown-up").css({top:o.pageY-20-d,left:o.pageX-13}).fadeIn(m)}else{p.css({top:o.pageY+10,left:o.pageX-13}).fadeIn(m)}}}});if(f){h.draggable()}b(h).on("contextmenu",function(){c.close()});b(h).on("click","#cmenu-close-"+k,function(){c.close()})}}(jQuery));